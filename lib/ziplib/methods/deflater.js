function JSDeflater(n){function r(n,r){en=n,fn=0,Zn(r);var e,f=new Array(1024),t=[],o=0;for(e=0;1024>e;e++)f[e]=0;for(;(e=vr(f,0,f.length))>0;){var a=new Buffer(f.slice(0,e));t.push(a),o+=a.length}if(1==t.length)return t[0];var l=new Buffer(o),i=0;for(e=0;e<t.length;e++)t[e].copy(l,i),i+=t[e].length;return l}var e,f,t,o,a,l,i,c,u,d,w,s,h,_,v,y,x,A,m,g,b,p,I,z,k,B,D,S,J,q,R,j,C,E,F,G,H,K,L,M,N,O,P,Q,T,U,V,W,X,Y,Z,$,nn,rn,en,fn,tn=32768,on=0,an=1,ln=2,cn=6,un=!0,dn=32768,wn=64,sn=8192,hn=2*tn,_n=3,vn=258,yn=16,xn=8192,An=13,mn=xn,gn=1<<An,bn=gn-1,pn=tn-1,In=0,zn=4096,kn=vn+_n+1,Bn=tn-kn,Dn=1,Sn=15,Jn=7,qn=29,Rn=256,jn=256,Cn=Rn+1+qn,En=30,Fn=19,Gn=16,Hn=17,Kn=18,Ln=2*Cn+1,Mn=parseInt((An+_n-1)/_n),Nn=null,On=function(){this.fc=0,this.dl=0},Pn=function(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0},Qn=function(n,r,e,f){this.good_length=n,this.max_lazy=r,this.nice_length=e,this.max_chain=f},Tn=function(){this.next=null,this.len=0,this.ptr=new Array(sn),this.off=0},Un=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0),Vn=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),Wn=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7),Xn=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15),Yn=new Array(new Qn(0,0,0,0),new Qn(4,4,8,4),new Qn(4,5,16,8),new Qn(4,6,32,32),new Qn(4,4,16,16),new Qn(8,16,32,32),new Qn(8,16,128,128),new Qn(8,32,128,256),new Qn(32,128,258,1024),new Qn(32,258,258,4096)),Zn=function(n){var r;if(n?1>n?n=1:n>9&&(n=9):n=cn,D=n,o=!1,I=!1,null==Nn){for(e=f=t=null,Nn=new Array(sn),c=new Array(hn),u=new Array(mn),d=new Array(dn+wn),w=new Array(1<<yn),q=new Array(Ln),r=0;Ln>r;r++)q[r]=new On;for(R=new Array(2*En+1),r=0;2*En+1>r;r++)R[r]=new On;for(j=new Array(Cn+2),r=0;Cn+2>r;r++)j[r]=new On;for(C=new Array(En),r=0;En>r;r++)C[r]=new On;for(E=new Array(2*Fn+1),r=0;2*Fn+1>r;r++)E[r]=new On;F=new Pn,G=new Pn,H=new Pn,K=new Array(Sn+1),L=new Array(2*Cn+1),O=new Array(2*Cn+1),P=new Array(vn-_n+1),Q=new Array(512),T=new Array(qn),U=new Array(En),V=new Array(parseInt(xn/8))}},$n=function(n){n.next=e,e=n},nr=function(){var n;return null!=e?(n=e,e=e.next):n=new Tn,n.next=null,n.len=n.off=0,n},rr=function(n){return w[tn+n]},er=function(n,r){return w[tn+n]=r},fr=function(n){Nn[l+a++]=n,l+a==sn&&Er()},tr=function(n){n&=65535,sn-2>l+a?(Nn[l+a++]=255&n,Nn[l+a++]=n>>>8):(fr(255&n),fr(n>>>8))},or=function(){v=(v<<Mn^255&c[b+_n-1])&bn,y=rr(v),w[b&pn]=y,er(v,b)},ar=function(n,r){Rr(r[n].fc,r[n].dl)},lr=function(n){return 255&(256>n?Q[n]:Q[256+(n>>7)])},ir=function(n,r,e){return n[r].fc<n[e].fc||n[r].fc==n[e].fc&&O[r]<=O[e]},cr=function(n,r,e){var f;for(f=0;e>f&&fn<en.length;f++)n[r+f]=255&en[fn++];return f},ur=function(){var n;for(n=0;gn>n;n++)w[tn+n]=0;if(B=Yn[D].max_lazy,S=Yn[D].good_length,un||(J=Yn[D].nice_length),k=Yn[D].max_chain,b=0,_=0,z=cr(c,0,2*tn),0>=z)return I=!0,void(z=0);for(I=!1;kn>z&&!I;)wr();for(v=0,n=0;_n-1>n;n++)v=(v<<Mn^255&c[n])&bn},dr=function(n){var r,e,f=k,t=b,o=g,a=b>Bn?b-Bn:In,l=b+vn,i=c[t+o-1],u=c[t+o];g>=S&&(f>>=2);do if(r=n,c[r+o]==u&&c[r+o-1]==i&&c[r]==c[t]&&c[++r]==c[t+1]){t+=2,r++;do;while(c[++t]==c[++r]&&c[++t]==c[++r]&&c[++t]==c[++r]&&c[++t]==c[++r]&&c[++t]==c[++r]&&c[++t]==c[++r]&&c[++t]==c[++r]&&c[++t]==c[++r]&&l>t);if(e=vn-(l-t),t=l-vn,e>o){if(p=n,o=e,un){if(e>=vn)break}else if(e>=J)break;i=c[t+o-1],u=c[t+o]}}while((n=w[n&pn])>a&&0!=--f);return o},wr=function(){var n,r,e=hn-z-b;if(-1==e)e--;else if(b>=tn+Bn){for(n=0;tn>n;n++)c[n]=c[n+tn];for(p-=tn,b-=tn,_-=tn,n=0;gn>n;n++)r=rr(n),er(n,r>=tn?r-tn:In);for(n=0;tn>n;n++)r=w[n],w[n]=r>=tn?r-tn:In;e+=tn}I||(n=cr(c,b+z,e),0>=n?I=!0:z+=n)},sr=function(){for(;0!=z&&null==f;){var n;if(or(),y!=In&&Bn>=b-y&&(m=dr(y),m>z&&(m=z)),m>=_n)if(n=Sr(b-p,m-_n),z-=m,B>=m){m--;do b++,or();while(0!=--m);b++}else b+=m,m=0,v=255&c[b],v=(v<<Mn^255&c[b+1])&bn;else n=Sr(0,255&c[b]),z--,b++;for(n&&(Dr(0),_=b);kn>z&&!I;)wr()}},hr=function(){for(;0!=z&&null==f;){if(or(),g=m,x=p,m=_n-1,y!=In&&B>g&&Bn>=b-y&&(m=dr(y),m>z&&(m=z),m==_n&&b-p>zn&&m--),g>=_n&&g>=m){var n;n=Sr(b-1-x,g-_n),z-=g-1,g-=2;do b++,or();while(0!=--g);A=0,m=_n-1,b++,n&&(Dr(0),_=b)}else 0!=A?(Sr(0,255&c[b-1])&&(Dr(0),_=b),b++,z--):(A=1,b++,z--);for(;kn>z&&!I;)wr()}},_r=function(){I||(s=0,h=0,xr(),ur(),f=null,a=0,l=0,A=0,3>=D?(g=_n-1,m=0):(m=_n-1,A=0,A=0),i=!1)},vr=function(n,r,e){var f;return o||(_r(),o=!0,0!=z)?(f=yr(n,r,e))==e?e:i?f:(3>=D?sr():hr(),0==z&&(0!=A&&Sr(0,255&c[b-1]),Dr(1),i=!0),f+yr(n,f+r,e-f)):(i=!0,0)},yr=function(n,r,e){var t,o,i;for(t=0;null!=f&&e>t;){for(o=e-t,o>f.len&&(o=f.len),i=0;o>i;i++)n[r+t+i]=f.ptr[f.off+i];if(f.off+=o,f.len-=o,t+=o,0==f.len){var c;c=f,f=f.next,$n(c)}}if(t==e)return t;if(a>l){for(o=e-t,o>a-l&&(o=a-l),i=0;o>i;i++)n[r+t+i]=Nn[l+i];l+=o,t+=o,a==l&&(a=l=0)}return t},xr=function(){var n,r,e,f,t;if(0==C[0].dl){for(F.dyn_tree=q,F.static_tree=j,F.extra_bits=Un,F.extra_base=Rn+1,F.elems=Cn,F.max_length=Sn,F.max_code=0,G.dyn_tree=R,G.static_tree=C,G.extra_bits=Vn,G.extra_base=0,G.elems=En,G.max_length=Sn,G.max_code=0,H.dyn_tree=E,H.static_tree=null,H.extra_bits=Wn,H.extra_base=0,H.elems=Fn,H.max_length=Jn,H.max_code=0,e=0,f=0;qn-1>f;f++)for(T[f]=e,n=0;n<1<<Un[f];n++)P[e++]=f;for(P[e-1]=f,t=0,f=0;16>f;f++)for(U[f]=t,n=0;n<1<<Vn[f];n++)Q[t++]=f;for(t>>=7;En>f;f++)for(U[f]=t<<7,n=0;n<1<<Vn[f]-7;n++)Q[256+t++]=f;for(r=0;Sn>=r;r++)K[r]=0;for(n=0;143>=n;)j[n++].dl=8,K[8]++;for(;255>=n;)j[n++].dl=9,K[9]++;for(;279>=n;)j[n++].dl=7,K[7]++;for(;287>=n;)j[n++].dl=8,K[8]++;for(br(j,Cn+1),n=0;En>n;n++)C[n].dl=5,C[n].fc=jr(n,5);Ar()}},Ar=function(){var n;for(n=0;Cn>n;n++)q[n].fc=0;for(n=0;En>n;n++)R[n].fc=0;for(n=0;Fn>n;n++)E[n].fc=0;q[jn].fc=1,nn=rn=0,W=X=Y=0,Z=0,$=1},mr=function(n,r){for(var e=L[r],f=r<<1;M>=f&&(M>f&&ir(n,L[f+1],L[f])&&f++,!ir(n,e,L[f]));)L[r]=L[f],r=f,f<<=1;L[r]=e},gr=function(n){var r,e,f,t,o,a,l=n.dyn_tree,i=n.extra_bits,c=n.extra_base,u=n.max_code,d=n.max_length,w=n.static_tree,s=0;for(t=0;Sn>=t;t++)K[t]=0;for(l[L[N]].dl=0,r=N+1;Ln>r;r++)e=L[r],t=l[l[e].dl].dl+1,t>d&&(t=d,s++),l[e].dl=t,e>u||(K[t]++,o=0,e>=c&&(o=i[e-c]),a=l[e].fc,nn+=a*(t+o),null!=w&&(rn+=a*(w[e].dl+o)));if(0!=s){do{for(t=d-1;0==K[t];)t--;K[t]--,K[t+1]+=2,K[d]--,s-=2}while(s>0);for(t=d;0!=t;t--)for(e=K[t];0!=e;)f=L[--r],f>u||(l[f].dl!=t&&(nn+=(t-l[f].dl)*l[f].fc,l[f].fc=t),e--)}},br=function(n,r){var e,f,t=new Array(Sn+1),o=0;for(e=1;Sn>=e;e++)o=o+K[e-1]<<1,t[e]=o;for(f=0;r>=f;f++){var a=n[f].dl;0!=a&&(n[f].fc=jr(t[a]++,a))}},pr=function(n){var r,e,f=n.dyn_tree,t=n.static_tree,o=n.elems,a=-1,l=o;for(M=0,N=Ln,r=0;o>r;r++)0!=f[r].fc?(L[++M]=a=r,O[r]=0):f[r].dl=0;for(;2>M;){var i=L[++M]=2>a?++a:0;f[i].fc=1,O[i]=0,nn--,null!=t&&(rn-=t[i].dl)}for(n.max_code=a,r=M>>1;r>=1;r--)mr(f,r);do r=L[Dn],L[Dn]=L[M--],mr(f,Dn),e=L[Dn],L[--N]=r,L[--N]=e,f[l].fc=f[r].fc+f[e].fc,O[r]>O[e]+1?O[l]=O[r]:O[l]=O[e]+1,f[r].dl=f[e].dl=l,L[Dn]=l++,mr(f,Dn);while(M>=2);L[--N]=L[Dn],gr(n),br(f,a)},Ir=function(n,r){var e,f,t=-1,o=n[0].dl,a=0,l=7,i=4;for(0==o&&(l=138,i=3),n[r+1].dl=65535,e=0;r>=e;e++)f=o,o=n[e+1].dl,++a<l&&f==o||(i>a?E[f].fc+=a:0!=f?(f!=t&&E[f].fc++,E[Gn].fc++):10>=a?E[Hn].fc++:E[Kn].fc++,a=0,t=f,0==o?(l=138,i=3):f==o?(l=6,i=3):(l=7,i=4))},zr=function(n,r){var e,f,t=-1,o=n[0].dl,a=0,l=7,i=4;for(0==o&&(l=138,i=3),e=0;r>=e;e++)if(f=o,o=n[e+1].dl,!(++a<l&&f==o)){if(i>a){do ar(f,E);while(0!=--a)}else 0!=f?(f!=t&&(ar(f,E),a--),ar(Gn,E),Rr(a-3,2)):10>=a?(ar(Hn,E),Rr(a-3,3)):(ar(Kn,E),Rr(a-11,7));a=0,t=f,0==o?(l=138,i=3):f==o?(l=6,i=3):(l=7,i=4)}},kr=function(){var n;for(Ir(q,F.max_code),Ir(R,G.max_code),pr(H),n=Fn-1;n>=3&&0==E[Xn[n]].dl;n--);return nn+=3*(n+1)+5+5+4,n},Br=function(n,r,e){var f;for(Rr(n-257,5),Rr(r-1,5),Rr(e-4,4),f=0;e>f;f++)Rr(E[Xn[f]].dl,3);zr(q,n-1),zr(R,r-1)},Dr=function(n){var r,e,f,t;if(t=b-_,V[Y]=Z,pr(F),pr(G),f=kr(),r=nn+3+7>>3,e=rn+3+7>>3,r>=e&&(r=e),r>=t+4&&_>=0){var o;for(Rr((on<<1)+n,3),Cr(),tr(t),tr(~t),o=0;t>o;o++)fr(c[_+o])}else e==r?(Rr((an<<1)+n,3),Jr(j,C)):(Rr((ln<<1)+n,3),Br(F.max_code+1,G.max_code+1,f+1),Jr(q,R));Ar(),0!=n&&Cr()},Sr=function(n,r){if(d[W++]=r,0==n?q[r].fc++:(n--,q[P[r]+Rn+1].fc++,R[lr(n)].fc++,u[X++]=n,Z|=$),$<<=1,0==(7&W)&&(V[Y++]=Z,Z=0,$=1),D>2&&0==(4095&W)){var e,f=8*W,t=b-_;for(e=0;En>e;e++)f+=R[e].fc*(5+Vn[e]);if(f>>=3,X<parseInt(W/2)&&f<parseInt(t/2))return!0}return W==xn-1||X==mn},Jr=function(n,r){var e,f,t,o,a=0,l=0,i=0,c=0;if(0!=W)do 0==(7&a)&&(c=V[i++]),f=255&d[a++],0==(1&c)?ar(f,n):(t=P[f],ar(t+Rn+1,n),o=Un[t],0!=o&&(f-=T[t],Rr(f,o)),e=u[l++],t=lr(e),ar(t,r),o=Vn[t],0!=o&&(e-=U[t],Rr(e,o))),c>>=1;while(W>a);ar(jn,n)},qr=16,Rr=function(n,r){h>qr-r?(s|=n<<h,tr(s),s=n>>qr-h,h+=r-qr):(s|=n<<h,h+=r)},jr=function(n,r){var e=0;do e|=1&n,n>>=1,e<<=1;while(--r>0);return e>>1},Cr=function(){h>8?tr(s):h>0&&fr(s),s=0,h=0},Er=function(){if(0!=a){var n,r;for(n=nr(),null==f?f=t=n:t=t.next=n,n.len=a-l,r=0;r<n.len;r++)n.ptr[r]=Nn[l+r];a=l=0}};return{deflate:function(){return r(n,8)}}}module.exports=function(n){var r=require("zlib");return{deflate:function(){return new JSDeflater(n).deflate()},deflateAsync:function(e){var f=r.createDeflateRaw({chunkSize:1024*(parseInt(n.length/1024)+1)}),t=[],o=0;f.on("data",function(n){t.push(n),o+=n.length}),f.on("end",function(){var n=new Buffer(o),r=0;n.fill(0);for(var f=0;f<t.length;f++){var a=t[f];a.copy(n,r),r+=a.length}e&&e(n)}),f.end(n)}}};