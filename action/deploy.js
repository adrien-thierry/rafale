function Deploy(){function r(r){try{if(r){if(void 0!=r.exec&&0==r.exec&&(EXEC=!1),r.mkdir)for(var o in r.mkdir)try{fs.mkdirSync(path.join(g,r.mkdir[o]))}catch(e){}if(r.config)try{fs.writeFileSync(path.join(g,"config.json"),JSON.stringify(r.config))}catch(e){}}try{fs.chmodSync(h,493)}catch(e){}}catch(e){console.log("Error : "+e.message)}EXEC&&t()}function t(){if("win32"===platform){var r=require("readline").createInterface({input:process.stdin,output:process.stdout});r.on("SIGINT",function(){try{rmdir(g)}catch(r){}})}process.on("SIGINT",function(){try{rmdir(g)}catch(r){}}),process.chdir(g);var t=spawn("./"+m);t.stdout.on("data",function(r){process.stdout.write(r.toString())}),t.stderr.on("data",function(r){process.stdout.write(r.toString())}),t.on("error",function(r){console.log(r),rmdir(g)}),t.on("exit",function(r){rmdir(g)})}var o,e=URL;CLI.cli["--deploy"]&&(o=CLI.cli["--deploy"].argument[0]),CLI.cli["--url"]&&(e=CLI.cli["--url"].argument[0]),CLI.cli["--no-exec"]&&(EXEC=!1);var n;n=CLI.cli["--target"]?CLI.cli["--target"].argument[0]:platform+"-"+archtype,VALID_TARGET.indexOf(n)<0&&(console.log("[!] Unknown platform type"),process.exit());var i=url.parse(e),c=i.protocol||"https",a=i.hostname,s=i.port||443,d="crusadr/",p="get/",l="preset/";if(!o)return void console.error("[!] Missing id");var f=crypto.randomBytes(8).readUInt32LE(0),u="rafale_"+f,m="fortressjs",g=path.join(tmp,u)+"/";CLI.cli["--out"]&&(g=CLI.cli["--out"].argument[0]);var h=path.join(g,m);try{fs.mkdirSync(g)}catch(y){}"win32"==platform&&(m+=".exe");var v,I={method:"GET",port:s,hostname:a,path:"/"+d+p+l+o+"/"+n};v="https:"==c?https:http;var C=v.request(I,function(t){var o="";t.on("data",function(r){o+=r.toString("utf-8")}),t.on("end",function(){try{var t=JSON.parse(o);if(0==t.code){t.data.entry&&(m=t.data.entry,h=path.join(g,t.data.entry));var e=new zip(new Buffer(t.data.zip,"base64"));e.extractAllTo(g,!0),r(t.data.post)}else console.log("[!] An error occured : "+t.message)}catch(n){return console.log("[!] Error : "+n.message),void rmdir(g)}}),t.on("error",function(r){console.log("[!] Error : "+r.message),rmdir(g)})});C.end()}module.exports=Deploy;